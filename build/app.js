(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
(function (global){
'use strict';

angular.module('app', ['infinite-scroll']).constant('ENDPOINT_URI', 'http://localhost:8001/api/').controller('MainCtrl', ['$scope', '$http', 'ENDPOINT_URI', function ($scope, $http, ENDPOINT_URI) {

   var vm = this;
   var loadedThreadList = [];
   var currPage = 1;
   var nextPage = false;
   var canAdd = true;
   vm.threadList = [];

   vm.enableAddMore = function () {
      return canAdd = true;
   };
   vm.disableAddMore = function () {
      return canAdd = false;
   };

   vm.addMore = function (force) {

      if (!canAdd && !force) {
         return;
      }

      if (loadedThreadList.length > 0) {

         vm.threadList.push(loadedThreadList.shift());
         console.log('loading thread:', vm.threadList.length);
      } else {

         console.log('end of page.');

         if (nextPage) {
            loadThread();
            nextPage = false;
         }
      }
   };

   global.MORE = function () {
      vm.addMore();
      $scope.$apply();
   };

   function loadThread() {

      console.log('loading page:', currPage);
      $http.get(ENDPOINT_URI + 'thread/' + currPage).success(function (loadedThreadList_) {

         console.log(loadedThreadList_.length);
         console.log(loadedThreadList_);
         loadedThreadList = loadedThreadList_;

         currPage++;
         nextPage = true;

         vm.addMore();
         vm.addMore();
      }).error(function (err) {
         console.warn(err);
      });
   }

   loadThread();
}]).directive('threadList', [function () {

   return {

      restrict: 'E',
      scope: true,
      template: '<thread-item ng-repeat="thread in main.threadList"></thread-item>'

   };
}]).directive('threadItem', ['$http', 'ENDPOINT_URI', function ($http, ENDPOINT_URI) {

   function controller($scope) {

      $scope.main.disableAddMore();

      $scope.loadComplete = false;
      var totalImgs = 0;
      var loaded = 0;

      $scope.itemEnd = function () {
         loaded++;
         if (loaded >= totalImgs) {

            $scope.loadComplete = true;
            $scope.main.enableAddMore();

            $scope.$apply();
            console.log('complete', $scope);
            console.log('----------------------------');
         }
      };

      $http.post(ENDPOINT_URI + 'post', { thread: $scope.thread }).success(function (res) {

         $scope.imgUrlList = res.imgUrlList;
         totalImgs = res.imgUrlList.length;

         console.log('loading', totalImgs, 'imgs');

         if (totalImgs === 0) {
            $scope.loadComplete = true;
            $scope.main.enableAddMore();
            console.log('complete', $scope);
         }
      }).error(function (err) {

         console.warn('threadItem directive POST ERR:', err);
         $scope.loadComplete = true;
         $scope.main.enableAddMore();
      });
   }

   return {

      restrict: 'E',
      replace: true,
      scope: true,
      controller: controller,
      controllerAs: 'tItem',
      template: ['<div>', '<div ng-hide="loadComplete" style="height: 50px; background: #c3c3c3">', 'LOADING...', '</div>', '<div ng-show="loadComplete">', '<thread-img ng-repeat="url in imgUrlList"></thread-img>', '<br>', '<a href="{{thread}}">{{thread}}</a>', '<br><br>', '</div>', '</div>'].join('')
   };
}]).directive('threadImg', [function () {

   function controller($scope, $element) {

      $element.on('load', function () {
         console.log(' img done.');
         $scope.itemEnd();
      }).on('error', function () {
         console.warn('img load err.');
         $scope.itemEnd();
      });
   }

   return {

      restrict: 'E',
      replace: true,
      scope: true,
      controller: controller,
      controllerAs: 'tImg',
      template: '<img ng-src="{{url}}" width="500px">'

   };
}]);

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvVXNlcnMvTklYL0RvY3VtZW50cy9uaXgvdGh6LXNjcmFwZXIvc3JjL2luZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7O0FDQUEsT0FBTyxDQUFDLE1BQU0sQ0FBRSxLQUFLLEVBQUUsQ0FDcEIsaUJBQWlCLENBQ25CLENBQUUsQ0FDRixRQUFRLENBQUUsY0FBYyxFQUFFLDRCQUE0QixDQUFFLENBQ3hELFVBQVUsQ0FBRSxVQUFVLEVBQUUsQ0FBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLGNBQWMsRUFBRSxVQUFXLE1BQU0sRUFBRSxLQUFLLEVBQUUsWUFBWSxFQUFJOztBQUVyRyxPQUFJLEVBQUUsR0FBRyxJQUFJLENBQUM7QUFDZCxPQUFJLGdCQUFnQixHQUFHLEVBQUUsQ0FBQztBQUMxQixPQUFJLFFBQVEsR0FBRyxDQUFDLENBQUM7QUFDakIsT0FBSSxRQUFRLEdBQUcsS0FBSyxDQUFDO0FBQ3JCLE9BQUksTUFBTSxHQUFHLElBQUksQ0FBQztBQUNsQixLQUFFLENBQUMsVUFBVSxHQUFHLEVBQUUsQ0FBQzs7QUFFbkIsS0FBRSxDQUFDLGFBQWEsR0FBRzthQUFNLE1BQU0sR0FBRyxJQUFJO0lBQUEsQ0FBQztBQUN2QyxLQUFFLENBQUMsY0FBYyxHQUFHO2FBQU0sTUFBTSxHQUFHLEtBQUs7SUFBQSxDQUFDOztBQUV6QyxLQUFFLENBQUMsT0FBTyxHQUFHLFVBQVUsS0FBSyxFQUFHOztBQUU1QixVQUFLLENBQUMsTUFBTSxJQUFJLENBQUMsS0FBSyxFQUFFO0FBQ3JCLGdCQUFPO09BQ1Q7O0FBRUQsVUFBSyxnQkFBZ0IsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFHOztBQUVoQyxXQUFFLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBRSxnQkFBZ0IsQ0FBQyxLQUFLLEVBQUUsQ0FBRSxDQUFDO0FBQy9DLGdCQUFPLENBQUMs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TyxFQUFFLFlBQVk7QUFDdkIsZ0JBQU8sQ0FBQyxJQUFJLENBQUUsZUFBZSxDQUFFLENBQUM7QUFDaEMsZUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDO09BQ25CLENBQUUsQ0FBQztJQUVOOztBQUVELFVBQU87O0FBRUosY0FBUSxFQUFFLEdBQUc7QUFDYixhQUFPLEVBQUUsSUFBSTtBQUNiLFdBQUssRUFBRSxJQUFJO0FBQ1gsZ0JBQVUsRUFBVixVQUFVO0FBQ1Ysa0JBQVksRUFBRSxNQUFNO0FBQ3BCLGNBQVEsRUFBRSxzQ0FBc0M7O0lBRWxELENBQUM7Q0FFSixDQUFFLENBQUUsQ0FFSiIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJhbmd1bGFyLm1vZHVsZSggJ2FwcCcsIFtcbiAgICdpbmZpbml0ZS1zY3JvbGwnXG5dIClcbi5jb25zdGFudCggJ0VORFBPSU5UX1VSSScsICdodHRwOi8vbG9jYWxob3N0OjgwMDEvYXBpLycgKVxuLmNvbnRyb2xsZXIoICdNYWluQ3RybCcsIFsgJyRzY29wZScsICckaHR0cCcsICdFTkRQT0lOVF9VUkknLCBmdW5jdGlvbiAoICRzY29wZSwgJGh0dHAsIEVORFBPSU5UX1VSSSApICB7XG5cbiAgIHZhciB2bSA9IHRoaXM7XG4gICB2YXIgbG9hZGVkVGhyZWFkTGlzdCA9IFtdO1xuICAgdmFyIGN1cnJQYWdlID0gMTtcbiAgIHZhciBuZXh0UGFnZSA9IGZhbHNlO1xuICAgdmFyIGNhbkFkZCA9IHRydWU7XG4gICB2bS50aHJlYWRMaXN0ID0gW107XG5cbiAgIHZtLmVuYWJsZUFkZE1vcmUgPSAoKSA9PiBjYW5BZGQgPSB0cnVlO1xuICAgdm0uZGlzYWJsZUFkZE1vcmUgPSAoKSA9PiBjYW5BZGQgPSBmYWxzZTtcblxuICAgdm0uYWRkTW9yZSA9IGZ1bmN0aW9uKCBmb3JjZSApIHtcblxuICAgICAgaWYgKCAhY2FuQWRkICYmICFmb3JjZSkge1xuICAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoIGxvYWRlZFRocmVhZExpc3QubGVuZ3RoID4gMCApIHtcblxuICAgICAgICAgdm0udGhyZWFkTGlzdC5wdXNoKCBsb2FkZWRUaHJlYWRMaXN0LnNoaWZ0KCkgKTtcbiAgICAgICAgIGNvbnNvbGUubG9nKCAnbG9hZGluZyB0aHJlYWQ6Jywgdm0udGhyZWFkTGlzdC5sZW5ndGggKTtcblxuICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgY29uc29sZS5sb2coICdlbmQgb2YgcGFnZS4nICk7XG5cbiAgICAgICAgIGlmICggbmV4dFBhZ2UgKSB7XG4gICAgICAgICAgICBsb2FkVGhyZWFkKCk7XG4gICAgICAgICAgICBuZXh0UGFnZSA9IGZhbHNlO1xuICAgICAgICAgfVxuXG4gICAgICB9XG5cbiAgIH07XG5cbiAgIGdsb2JhbC5NT1JFID0gZnVuY3Rpb24gKCkge1xuICAgICAgdm0uYWRkTW9yZSgpO1xuICAgICAgJHNjb3BlLiRhcHBseSgpO1xuICAgfTtcblxuICAgZnVuY3Rpb24gbG9hZFRocmVhZCgpIHtcblxuICAgICAgY29uc29sZS5sb2coICdsb2FkaW5nIHBhZ2U6JywgY3VyclBhZ2UgKTtcbiAgICAgICRodHRwLmdldCggRU5EUE9JTlRfVVJJICsgJ3RocmVhZC8nICsgY3VyclBhZ2UgKVxuICAgICAgLnN1Y2Nlc3MoIGZ1bmN0aW9uKCBsb2FkZWRUaHJlYWRMaXN0XyApIHtcblxuICAgICAgICAgY29uc29sZS5sb2coIGxvYWRlZFRocmVhZExpc3RfLmxlbmd0aCApO1xuICAgICAgICAgY29uc29sZS5sb2coIGxvYWRlZFRocmVhZExpc3RfICk7XG4gICAgICAgICBsb2FkZWRUaHJlYWRMaXN0ID0gbG9hZGVkVGhyZWFkTGlzdF87XG5cbiAgICAgICAgIGN1cnJQYWdlICsrO1xuICAgICAgICAgbmV4dFBhZ2UgPSB0cnVlO1xuXG4gICAgICAgICB2bS5hZGRNb3JlKCk7XG4gICAgICAgICB2bS5hZGRNb3JlKCk7XG5cbiAgICAgIH0gKVxuICAgICAgLmVycm9yKCBmdW5jdGlvbiggZXJyICkge1xuICAgICAgICAgY29uc29sZS53YXJuKCBlcnIgKTtcbiAgICAgIH0gKTtcblxuICAgfVxuXG4gICBsb2FkVGhyZWFkKCk7XG5cbn0gXSApXG4uZGlyZWN0aXZlKCAndGhyZWFkTGlzdCcsIFsgZnVuY3Rpb24gKCkge1xuXG4gICByZXR1cm4ge1xuXG4gICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgc2NvcGU6IHRydWUsXG4gICAgICB0ZW1wbGF0ZTogJzx0aHJlYWQtaXRlbSBuZy1yZXBlYXQ9XCJ0aHJlYWQgaW4gbWFpbi50aHJlYWRMaXN0XCI+PC90aHJlYWQtaXRlbT4nXG5cbiAgIH07XG5cbn0gXSApXG4uZGlyZWN0aXZlKCAndGhyZWFkSXRlbScsIFsgJyRodHRwJywgJ0VORFBPSU5UX1VSSScsIGZ1bmN0aW9uICggJGh0dHAsIEVORFBPSU5UX1VSSSApIHtcblxuICAgZnVuY3Rpb24gY29udHJvbGxlciggJHNjb3BlICkge1xuXG4gICAgICAkc2NvcGUubWFpbi5kaXNhYmxlQWRkTW9yZSgpO1xuXG4gICAgICAkc2NvcGUubG9hZENvbXBsZXRlID0gZmFsc2U7XG4gICAgICB2YXIgdG90YWxJbWdzID0gMDtcbiAgICAgIHZhciBsb2FkZWQgPSAwO1xuXG4gICAgICAkc2NvcGUuaXRlbUVuZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgIGxvYWRlZCArKztcbiAgICAgICAgIGlmICggbG9hZGVkID49IHRvdGFsSW1ncyApIHtcblxuICAgICAgICAgICAgJHNjb3BlLmxvYWRDb21wbGV0ZSA9IHRydWU7XG4gICAgICAgICAgICAkc2NvcGUubWFpbi5lbmFibGVBZGRNb3JlKCk7XG5cbiAgICAgICAgICAgICRzY29wZS4kYXBwbHkoKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnY29tcGxldGUnLCAkc2NvcGUgKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLScgKTtcbiAgICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgICRodHRwLnBvc3QoIEVORFBPSU5UX1VSSSArICdwb3N0JywgeyB0aHJlYWQ6ICRzY29wZS50aHJlYWQgfSApXG4gICAgICAuc3VjY2VzcyggZnVuY3Rpb24oIHJlcyApIHtcblxuICAgICAgICAgJHNjb3BlLmltZ1VybExpc3QgPSByZXMuaW1nVXJsTGlzdDtcbiAgICAgICAgIHRvdGFsSW1ncyA9IHJlcy5pbWdVcmxMaXN0Lmxlbmd0aDtcblxuICAgICAgICAgY29uc29sZS5sb2coICdsb2FkaW5nJywgdG90YWxJbWdzLCAnaW1ncycgKTtcblxuICAgICAgICAgaWYgKCB0b3RhbEltZ3MgPT09IDAgKSB7XG4gICAgICAgICAgICAkc2NvcGUubG9hZENvbXBsZXRlID0gdHJ1ZTtcbiAgICAgICAgICAgICRzY29wZS5tYWluLmVuYWJsZUFkZE1vcmUoKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnY29tcGxldGUnLCAkc2NvcGUgKTtcbiAgICAgICAgIH1cblxuICAgICAgfSApXG4gICAgICAuZXJyb3IoIGZ1bmN0aW9uKCBlcnIgKSB7XG5cbiAgICAgICAgIGNvbnNvbGUud2FybiggJ3RocmVhZEl0ZW0gZGlyZWN0aXZlIFBPU1QgRVJSOicsIGVyciApO1xuICAgICAgICAgJHNjb3BlLmxvYWRDb21wbGV0ZSA9IHRydWU7XG4gICAgICAgICAkc2NvcGUubWFpbi5lbmFibGVBZGRNb3JlKCk7XG5cbiAgICAgIH0gKTtcblxuICAgfVxuXG4gICByZXR1cm4ge1xuXG4gICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgcmVwbGFjZTogdHJ1ZSxcbiAgICAgIHNjb3BlOiB0cnVlLFxuICAgICAgY29udHJvbGxlcixcbiAgICAgIGNvbnRyb2xsZXJBczogJ3RJdGVtJyxcbiAgICAgIHRlbXBsYXRlOiBbXG4gICAgICAgICAnPGRpdj4nLFxuICAgICAgICAgICAgJzxkaXYgbmctaGlkZT1cImxvYWRDb21wbGV0ZVwiIHN0eWxlPVwiaGVpZ2h0OiA1MHB4OyBiYWNrZ3JvdW5kOiAjYzNjM2MzXCI+JyxcbiAgICAgICAgICAgICAgICdMT0FESU5HLi4uJyxcbiAgICAgICAgICAgICc8L2Rpdj4nLFxuICAgICAgICAgICAgJzxkaXYgbmctc2hvdz1cImxvYWRDb21wbGV0ZVwiPicsXG4gICAgICAgICAgICAgICAnPHRocmVhZC1pbWcgbmctcmVwZWF0PVwidXJsIGluIGltZ1VybExpc3RcIj48L3RocmVhZC1pbWc+JyxcbiAgICAgICAgICAgICAgICc8YnI+JyxcbiAgICAgICAgICAgICAgICc8YSBocmVmPVwie3t0aHJlYWR9fVwiPnt7dGhyZWFkfX08L2E+JyxcbiAgICAgICAgICAgICAgICc8YnI+PGJyPicsXG4gICAgICAgICAgICAnPC9kaXY+JyxcbiAgICAgICAgICc8L2Rpdj4nXG4gICAgICBdLmpvaW4oJycpXG4gICB9O1xuXG59IF0gKVxuLmRpcmVjdGl2ZSggJ3RocmVhZEltZycsIFsgZnVuY3Rpb24gKCkge1xuXG4gICBmdW5jdGlvbiBjb250cm9sbGVyKCAkc2NvcGUsICRlbGVtZW50ICkge1xuXG4gICAgICAkZWxlbWVudFxuICAgICAgLm9uKCAnbG9hZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgIGNvbnNvbGUubG9nKCAnIGltZyBkb25lLicgKTtcbiAgICAgICAgICRzY29wZS5pdGVtRW5kKCk7XG4gICAgICB9IClcbiAgICAgIC5vbiggJ2Vycm9yJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgY29uc29sZS53YXJuKCAnaW1nIGxvYWQgZXJyLicgKTtcbiAgICAgICAgICRzY29wZS5pdGVtRW5kKCk7XG4gICAgICB9ICk7XG5cbiAgIH1cblxuICAgcmV0dXJuIHtcblxuICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgIHJlcGxhY2U6IHRydWUsXG4gICAgICBzY29wZTogdHJ1ZSxcbiAgICAgIGNvbnRyb2xsZXIsXG4gICAgICBjb250cm9sbGVyQXM6ICd0SW1nJyxcbiAgICAgIHRlbXBsYXRlOiAnPGltZyBuZy1zcmM9XCJ7e3VybH19XCIgd2lkdGg9XCI1MDBweFwiPidcblxuICAgfTtcblxufSBdIClcblxuO1xuIl19
